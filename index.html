<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TerraHold ‚Äî 3D Earth AR Visualization</title>
    <meta name="description"
        content="Interactive 3D Earth AR visualization with real-time hand tracking. Control a photorealistic Earth globe with your hands using just a webcam.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Space+Grotesk:wght@400;500;600;700&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">

    <!-- Import Map for Three.js ES Modules -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.163.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.163.0/examples/jsm/"
        }
    }
    </script>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen">
        <div class="loader-content">
            <div class="earth-loader">
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-ring"></div>
                <div class="loader-globe">üåç</div>
            </div>
            <h1 class="loader-title">
                <span class="title-terra">Terra</span><span class="title-hold">Hold</span>
            </h1>
            <p class="loader-subtitle">Initializing AR Experience...</p>
            <div class="loader-progress">
                <div class="loader-progress-bar" id="progress-bar"></div>
            </div>
            <p class="loader-status" id="loading-status">Loading assets...</p>
        </div>
    </div>

    <!-- Camera Permission Error -->
    <div id="camera-error" class="hidden">
        <div class="error-content">
            <div class="error-icon">üì∑</div>
            <h2>Camera Access Required</h2>
            <p>TerraHold needs your webcam to create the AR experience. Please grant camera permission and reload.</p>
            <button onclick="location.reload()" class="retry-btn">Try Again</button>
        </div>
    </div>

    <!-- Instructions Overlay -->
    <div id="instructions" class="hidden">
        <div class="instructions-card">
            <div class="instructions-header">
                <h2>‚úã Hand Controls</h2>
                <button id="dismiss-instructions" class="close-btn">&times;</button>
            </div>
            <div class="instructions-body">
                <div class="instruction-item">
                    <div class="instruction-icon">ü§ö</div>
                    <div>
                        <strong>Left Hand</strong>
                        <p>Position & anchor the Earth on your palm</p>
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon">ü§è</div>
                    <div>
                        <strong>Right Hand ‚Äî Pinch</strong>
                        <p>Scale the Earth up or down</p>
                    </div>
                </div>
                <div class="instruction-item">
                    <div class="instruction-icon">‚úã</div>
                    <div>
                        <strong>Right Hand ‚Äî Open</strong>
                        <p>Rotate the Earth freely</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- HUD -->
    <div id="hud" class="hidden">
        <div class="hud-top-left">
            <span class="hud-logo">
                <span class="title-terra">Terra</span><span class="title-hold">Hold</span>
            </span>
        </div>
        <div class="hud-top-right">
            <span id="fps-counter" class="hud-badge">-- FPS</span>
            <button id="params-btn" class="hud-badge hud-btn">‚öôÔ∏è</button>
            <button id="toggle-instructions" class="hud-badge hud-btn">?</button>
        </div>
        <div class="hud-bottom">
            <div id="hand-status" class="hand-status-bar">
                <span id="left-hand-status" class="hand-indicator off">
                    <span class="dot"></span> Left Hand
                </span>
                <span id="right-hand-status" class="hand-indicator off">
                    <span class="dot"></span> Right Hand
                </span>
            </div>
        </div>

        <!-- Settings Panel -->
        <div id="params-panel" class="params-panel hidden">
            <h3>Settings</h3>
            <div class="setting-row">
                <label>Follow Hand</label>
                <input type="checkbox" id="toggle-follow" checked>
            </div>
            <div class="setting-row">
                <label>Enable Zoom</label>
                <input type="checkbox" id="toggle-zoom" checked>
            </div>
            <div class="setting-row">
                <label>Manual Rotate</label>
                <input type="checkbox" id="toggle-manual-rotate">
            </div>
            <div class="setting-row">
                <label>Auto Rotate</label>
                <input type="checkbox" id="toggle-auto-rotate" checked>
            </div>
            <div class="setting-row">
                <label>Show Skeleton</label>
                <input type="checkbox" id="toggle-skeleton">
            </div>
            <div class="setting-row">
                <label>Debug Logs</label>
                <input type="checkbox" id="toggle-debug">
            </div>
            <div class="setting-row">
                <label>Vertical Offset (<span id="offset-value">--</span>)</label>
                <input type="range" id="range-offset-y" min="0" max="300" value="120" style="width: 100px;">
            </div>
            <div class="setting-row">
                <label>Size (<span id="radius-value">6,371</span> km)</label>
                <input type="range" id="range-scale" min="0.392" max="3.532" step="0.001" value="1.0"
                    style="width: 100px;">
            </div>
            <button id="close-params" class="hud-btn-text">Close</button>
        </div>
    </div>

    <!-- Hidden video for webcam -->
    <video id="webcam" autoplay playsinline style="display:none;"></video>

    <!-- Main canvas for Three.js -->
    <canvas id="render-canvas"></canvas>

    <!-- MediaPipe Hands (non-module script) -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands@0.4.1675469240/hands.min.js"></script>

    <!-- App (ES Module) -->
    <script type="module" src="js/app.js"></script>
</body>

</html>